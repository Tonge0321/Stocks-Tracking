<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Monitor</title>
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #30363d;
            padding-bottom: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { margin: 0; color: #f0f6fc; font-size: 24px; }
        .timestamp { color: #8b949e; font-size: 14px; margin-top: 5px; }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
        }
        
        .card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .symbol { font-size: 20px; font-weight: bold; color: #58a6ff; }
        
        .price { font-size: 32px; font-weight: bold; color: #f0f6fc; margin-bottom: 5px; }
        
        .change { font-size: 16px; font-weight: 600; padding: 2px 6px; border-radius: 4px; }
        .positive { color: #3fb950; background: rgba(63,185,80,0.1); }
        .negative { color: #f85149; background: rgba(248,81,73,0.1); }
        .neutral { color: #8b949e; background: rgba(110,118,129,0.1); }
        
        .futures {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #30363d;
            color: #8b949e;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
        }
        .futures-val { color: #c9d1d9; font-family: monospace; font-size: 14px; }

        .loading, .error { grid-column: 1 / -1; text-align: center; padding: 40px; color: #8b949e; }
        .error { color: #f85149; border: 1px solid #f85149; border-radius: 6px; }
        
        button {
            background: #238636; color: white; border: none; padding: 6px 12px;
            border-radius: 6px; cursor: pointer; font-weight: 600;
        }
        button:hover { background: #2ea043; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>Market Dashboard</h1>
            <div id="time" class="timestamp">Initializing...</div>
        </div>
        <button onclick="updateData()">Refresh</button>
    </div>

    <div id="container" class="grid">
        <div class="loading">Loading data from Google Sheet...</div>
    </div>

    <script>
        // 您的 Apps Script 網址
        const API_URL = "https://script.google.com/macros/s/AKfycbwbZ-6VDAPGy6j3GOV64WAdgR5JSPZaYpXqoDr7Y5iLCoCOUYF10RNtywY52gntnsWp/exec";

        async function updateData() {
            const container = document.getElementById('container');
            const timeDisplay = document.getElementById('time');
            
            try {
                // 加 timestamp 防止快取
                const res = await fetch(`${API_URL}?t=${Date.now()}`);
                const data = await res.json();
                
                // 清空容器
                container.innerHTML = '';
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="error">No data received from Sheet.</div>';
                    return;
                }

                data.forEach(item => {
                    // 處理漲跌顏色
                    let change = item.changePercent || "0%";
                    let type = 'neutral';
                    if (change.includes('-')) type = 'negative';
                    else if (change !== "0%") type = 'positive';
                    
                    // 建立卡片
                    const el = document.createElement('div');
                    el.className = 'card';
                    el.innerHTML = `
                        <div class="card-header">
                            <span class="symbol">${item.symbol}</span>
                            <span class="change ${type}">${change}</span>
                        </div>
                        <div class="price">${item.price}</div>
                        <div class="futures">
                            <span>Futures / AH</span>
                            <span class="futures-val">${item.futuresPrice}</span>
                        </div>
                    `;
                    container.appendChild(el);
                });
                
                timeDisplay.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                
            } catch (err) {
                console.error(err);
                container.innerHTML = `<div class="error">Connection Failed.<br>${err.message}</div>`;
            }
        }

        // 啟動時執行
        window.onload = updateData;
    </script>
</body>
</html>
